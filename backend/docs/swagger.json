{
    "schemes": [
        "http",
        "https"
    ],
    "swagger": "2.0",
    "info": {
        "description": "Backend REST API para BlendPOS — punto de venta con soporte offline, facturación AFIP y gestión de inventario.",
        "title": "BlendPOS API",
        "termsOfService": "https://blendpos.ar/terms",
        "contact": {
            "name": "Soporte BlendPOS",
            "email": "soporte@blendpos.ar"
        },
        "license": {
            "name": "Private"
        },
        "version": "1.0"
    },
    "host": "localhost:8000",
    "basePath": "/",
    "paths": {
        "/v1/auth/login": {
            "post": {
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Login de usuario",
                "parameters": [
                    {
                        "description": "Credenciales",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.LoginRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/dto.LoginResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/auth/refresh": {
            "post": {
                "description": "Intercambia un refresh token válido por un nuevo access token.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Renovar token JWT",
                "parameters": [
                    {
                        "description": "Refresh token",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.RefreshRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/dto.LoginResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/caja/abrir": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "caja"
                ],
                "summary": "Abre una nueva sesion de caja",
                "parameters": [
                    {
                        "description": "Datos de apertura",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.AbrirCajaRequest"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Created",
                        "schema": {
                            "$ref": "#/definitions/dto.ReporteCajaResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/caja/arqueo": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "caja"
                ],
                "summary": "Realiza el arqueo ciego y cierra la sesion",
                "parameters": [
                    {
                        "description": "Declaracion de arqueo",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.ArqueoRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/dto.ArqueoResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/caja/movimiento": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "caja"
                ],
                "summary": "Registra un ingreso o egreso manual en caja",
                "parameters": [
                    {
                        "description": "Movimiento manual",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.MovimientoManualRequest"
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "No Content"
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/caja/{id}/reporte": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "caja"
                ],
                "summary": "Obtiene el reporte de una sesion de caja",
                "parameters": [
                    {
                        "type": "string",
                        "description": "ID de sesion",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/dto.ReporteCajaResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/precio/{barcode}": {
            "get": {
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "precio"
                ],
                "summary": "Consulta de precio por codigo de barras (sin autenticacion)",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Codigo de barras",
                        "name": "barcode",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/dto.ConsultaPreciosResponse"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/productos/{id}/historial-precios": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Retorna el historial inmutable de cambios de precio de un producto, ordenado por fecha descendente.",
                "tags": [
                    "productos"
                ],
                "summary": "Historial de precios de un producto",
                "parameters": [
                    {
                        "type": "string",
                        "description": "UUID del producto",
                        "name": "id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "type": "integer",
                        "description": "Página (default 1)",
                        "name": "page",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "Registros por página (default 50, max 200)",
                        "name": "limit",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/dto.HistorialPrecioListResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/usuarios": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "usuarios"
                ],
                "summary": "Crear usuario",
                "parameters": [
                    {
                        "description": "Datos del usuario",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.CrearUsuarioRequest"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Created",
                        "schema": {
                            "$ref": "#/definitions/dto.UsuarioResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/ventas": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Retorna lista paginada de ventas filtrada por fecha y estado.",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "ventas"
                ],
                "summary": "Listar ventas",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Fecha YYYY-MM-DD (default: hoy)",
                        "name": "fecha",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "completada | anulada | all",
                        "name": "estado",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "Página (default 1)",
                        "name": "page",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "Registros por página (default 50)",
                        "name": "limit",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/dto.VentaListResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            },
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Crea una venta ACID: descuenta stock, crea movimientos de caja y despacha facturación AFIP asíncrona.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "ventas"
                ],
                "summary": "Registrar una nueva venta",
                "parameters": [
                    {
                        "description": "Detalle de la venta",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.RegistrarVentaRequest"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Created",
                        "schema": {
                            "$ref": "#/definitions/dto.VentaResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/ventas/sync-batch": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Procesa un lote de ventas creadas offline. Idempotente por offline_id. Aplica auto-compensación de stock (déficit ≤ 3 unidades).",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "ventas"
                ],
                "summary": "Sincronizar ventas offline",
                "parameters": [
                    {
                        "description": "Lote de ventas",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.SyncBatchRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/dto.VentaResponse"
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        },
        "/v1/ventas/{id}": {
            "delete": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Anula una venta: restaura stock y genera movimientos de caja inversos.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "ventas"
                ],
                "summary": "Anular venta",
                "parameters": [
                    {
                        "type": "string",
                        "description": "UUID de la venta",
                        "name": "id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Motivo de anulación",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/dto.AnularVentaRequest"
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "No Content"
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/apierror.APIError"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "apierror.APIError": {
            "type": "object",
            "properties": {
                "detail": {
                    "type": "string"
                }
            }
        },
        "dto.AbrirCajaRequest": {
            "type": "object",
            "required": [
                "monto_inicial",
                "punto_de_venta"
            ],
            "properties": {
                "monto_inicial": {
                    "type": "number",
                    "minimum": 0
                },
                "punto_de_venta": {
                    "type": "integer",
                    "minimum": 1
                }
            }
        },
        "dto.AnularVentaRequest": {
            "type": "object",
            "required": [
                "motivo"
            ],
            "properties": {
                "motivo": {
                    "type": "string",
                    "minLength": 5
                }
            }
        },
        "dto.ArqueoRequest": {
            "type": "object",
            "required": [
                "declaracion",
                "sesion_caja_id"
            ],
            "properties": {
                "declaracion": {
                    "$ref": "#/definitions/dto.DeclaracionArqueo"
                },
                "observaciones": {
                    "type": "string"
                },
                "sesion_caja_id": {
                    "type": "string"
                }
            }
        },
        "dto.ArqueoResponse": {
            "type": "object",
            "properties": {
                "desvio": {
                    "$ref": "#/definitions/dto.DesvioResponse"
                },
                "estado": {
                    "type": "string"
                },
                "monto_declarado": {
                    "$ref": "#/definitions/dto.MontosPorMetodo"
                },
                "monto_esperado": {
                    "$ref": "#/definitions/dto.MontosPorMetodo"
                },
                "sesion_caja_id": {
                    "type": "string"
                }
            }
        },
        "dto.ConsultaPreciosResponse": {
            "type": "object",
            "properties": {
                "categoria": {
                    "type": "string"
                },
                "nombre": {
                    "type": "string"
                },
                "precio_venta": {
                    "type": "number"
                },
                "promocion": {
                    "type": "string"
                },
                "stock_disponible": {
                    "type": "integer"
                }
            }
        },
        "dto.CrearUsuarioRequest": {
            "type": "object",
            "required": [
                "nombre",
                "password",
                "rol",
                "username"
            ],
            "properties": {
                "email": {
                    "type": "string"
                },
                "nombre": {
                    "type": "string",
                    "maxLength": 100,
                    "minLength": 2
                },
                "password": {
                    "type": "string",
                    "minLength": 4
                },
                "punto_de_venta": {
                    "type": "integer"
                },
                "rol": {
                    "type": "string",
                    "enum": [
                        "cajero",
                        "supervisor",
                        "administrador"
                    ]
                },
                "username": {
                    "type": "string",
                    "maxLength": 150,
                    "minLength": 1
                }
            }
        },
        "dto.DeclaracionArqueo": {
            "type": "object",
            "properties": {
                "credito": {
                    "type": "number",
                    "minimum": 0
                },
                "debito": {
                    "type": "number",
                    "minimum": 0
                },
                "efectivo": {
                    "type": "number",
                    "minimum": 0
                },
                "transferencia": {
                    "type": "number",
                    "minimum": 0
                }
            }
        },
        "dto.DesvioResponse": {
            "type": "object",
            "properties": {
                "clasificacion": {
                    "description": "normal | advertencia | critico",
                    "type": "string"
                },
                "monto": {
                    "type": "number"
                },
                "porcentaje": {
                    "type": "number"
                }
            }
        },
        "dto.HistorialPrecioItem": {
            "type": "object",
            "properties": {
                "costo_antes": {
                    "type": "number"
                },
                "costo_despues": {
                    "type": "number"
                },
                "created_at": {
                    "type": "string"
                },
                "id": {
                    "type": "string"
                },
                "motivo": {
                    "type": "string"
                },
                "porcentaje_aplicado": {
                    "type": "number"
                },
                "producto_id": {
                    "type": "string"
                },
                "proveedor_id": {
                    "type": "string"
                },
                "proveedor_nombre": {
                    "type": "string"
                },
                "venta_antes": {
                    "type": "number"
                },
                "venta_despues": {
                    "type": "number"
                }
            }
        },
        "dto.HistorialPrecioListResponse": {
            "type": "object",
            "properties": {
                "data": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/dto.HistorialPrecioItem"
                    }
                },
                "limit": {
                    "type": "integer"
                },
                "page": {
                    "type": "integer"
                },
                "total": {
                    "type": "integer"
                }
            }
        },
        "dto.ItemVentaRequest": {
            "type": "object",
            "required": [
                "cantidad",
                "producto_id"
            ],
            "properties": {
                "cantidad": {
                    "type": "integer",
                    "minimum": 1
                },
                "descuento": {
                    "type": "number",
                    "minimum": 0
                },
                "producto_id": {
                    "type": "string"
                }
            }
        },
        "dto.ItemVentaResponse": {
            "type": "object",
            "properties": {
                "cantidad": {
                    "type": "integer"
                },
                "precio_unitario": {
                    "type": "number"
                },
                "producto": {
                    "type": "string"
                },
                "subtotal": {
                    "type": "number"
                }
            }
        },
        "dto.LoginRequest": {
            "type": "object",
            "required": [
                "password",
                "username"
            ],
            "properties": {
                "password": {
                    "type": "string",
                    "minLength": 4
                },
                "username": {
                    "type": "string",
                    "minLength": 1
                }
            }
        },
        "dto.LoginResponse": {
            "type": "object",
            "properties": {
                "access_token": {
                    "type": "string"
                },
                "expires_in": {
                    "description": "seconds",
                    "type": "integer"
                },
                "refresh_token": {
                    "type": "string"
                },
                "token_type": {
                    "type": "string"
                },
                "user": {
                    "$ref": "#/definitions/dto.UsuarioResponse"
                }
            }
        },
        "dto.MontosPorMetodo": {
            "type": "object",
            "properties": {
                "credito": {
                    "type": "number"
                },
                "debito": {
                    "type": "number"
                },
                "efectivo": {
                    "type": "number"
                },
                "total": {
                    "type": "number"
                },
                "transferencia": {
                    "type": "number"
                }
            }
        },
        "dto.MovimientoManualRequest": {
            "type": "object",
            "required": [
                "descripcion",
                "metodo_pago",
                "monto",
                "sesion_caja_id",
                "tipo"
            ],
            "properties": {
                "descripcion": {
                    "type": "string",
                    "minLength": 3
                },
                "metodo_pago": {
                    "type": "string",
                    "enum": [
                        "efectivo",
                        "debito",
                        "credito",
                        "transferencia"
                    ]
                },
                "monto": {
                    "type": "number"
                },
                "sesion_caja_id": {
                    "type": "string"
                },
                "tipo": {
                    "type": "string",
                    "enum": [
                        "ingreso_manual",
                        "egreso_manual"
                    ]
                }
            }
        },
        "dto.PagoRequest": {
            "type": "object",
            "required": [
                "metodo",
                "monto"
            ],
            "properties": {
                "metodo": {
                    "type": "string",
                    "enum": [
                        "efectivo",
                        "debito",
                        "credito",
                        "transferencia"
                    ]
                },
                "monto": {
                    "type": "number"
                }
            }
        },
        "dto.RefreshRequest": {
            "type": "object",
            "required": [
                "refresh_token"
            ],
            "properties": {
                "refresh_token": {
                    "type": "string"
                }
            }
        },
        "dto.RegistrarVentaRequest": {
            "type": "object",
            "required": [
                "items",
                "pagos",
                "sesion_caja_id"
            ],
            "properties": {
                "cliente_email": {
                    "description": "ClienteEmail: optional — when present, the facturacion worker mails the PDF receipt.",
                    "type": "string"
                },
                "items": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/dto.ItemVentaRequest"
                    }
                },
                "offline_id": {
                    "description": "OfflineID is set by the PWA when registering a sale created offline",
                    "type": "string"
                },
                "pagos": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/dto.PagoRequest"
                    }
                },
                "sesion_caja_id": {
                    "type": "string"
                }
            }
        },
        "dto.ReporteCajaResponse": {
            "type": "object",
            "properties": {
                "closed_at": {
                    "type": "string"
                },
                "desvio": {
                    "$ref": "#/definitions/dto.DesvioResponse"
                },
                "estado": {
                    "type": "string"
                },
                "monto_declarado": {
                    "$ref": "#/definitions/dto.MontosPorMetodo"
                },
                "monto_esperado": {
                    "$ref": "#/definitions/dto.MontosPorMetodo"
                },
                "monto_inicial": {
                    "type": "number"
                },
                "observaciones": {
                    "type": "string"
                },
                "opened_at": {
                    "type": "string"
                },
                "punto_de_venta": {
                    "type": "integer"
                },
                "sesion_caja_id": {
                    "type": "string"
                },
                "usuario": {
                    "type": "string"
                }
            }
        },
        "dto.SyncBatchRequest": {
            "type": "object",
            "required": [
                "ventas"
            ],
            "properties": {
                "ventas": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/dto.RegistrarVentaRequest"
                    }
                }
            }
        },
        "dto.UsuarioResponse": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "nombre": {
                    "type": "string"
                },
                "punto_de_venta": {
                    "type": "integer"
                },
                "rol": {
                    "type": "string"
                },
                "username": {
                    "type": "string"
                }
            }
        },
        "dto.VentaListItem": {
            "type": "object",
            "properties": {
                "created_at": {
                    "type": "string"
                },
                "descuento_total": {
                    "type": "number"
                },
                "estado": {
                    "type": "string"
                },
                "id": {
                    "type": "string"
                },
                "items": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/dto.ItemVentaResponse"
                    }
                },
                "numero_ticket": {
                    "type": "integer"
                },
                "pagos": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/dto.PagoRequest"
                    }
                },
                "sesion_caja_id": {
                    "type": "string"
                },
                "subtotal": {
                    "type": "number"
                },
                "total": {
                    "type": "number"
                },
                "usuario_id": {
                    "type": "string"
                }
            }
        },
        "dto.VentaListResponse": {
            "type": "object",
            "properties": {
                "data": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/dto.VentaListItem"
                    }
                },
                "limit": {
                    "type": "integer"
                },
                "page": {
                    "type": "integer"
                },
                "total": {
                    "type": "integer"
                }
            }
        },
        "dto.VentaResponse": {
            "type": "object",
            "properties": {
                "conflicto_stock": {
                    "type": "boolean"
                },
                "created_at": {
                    "type": "string"
                },
                "descuento_total": {
                    "type": "number"
                },
                "estado": {
                    "type": "string"
                },
                "id": {
                    "type": "string"
                },
                "items": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/dto.ItemVentaResponse"
                    }
                },
                "numero_ticket": {
                    "type": "integer"
                },
                "pagos": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/dto.PagoRequest"
                    }
                },
                "subtotal": {
                    "type": "number"
                },
                "total": {
                    "type": "number"
                },
                "vuelto": {
                    "type": "number"
                }
            }
        }
    },
    "securityDefinitions": {
        "BearerAuth": {
            "description": "Ingrese el token JWT con el prefijo \"Bearer\": Bearer \u003ctoken\u003e",
            "type": "apiKey",
            "name": "Authorization",
            "in": "header"
        }
    }
}